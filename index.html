<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WilsonPlus - Building Materials & Paints Inventory</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="Offline business inventory management application">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-paint-brush"></i> WilsonPlus</h1>
                <div class="header-actions">
                    <button id="syncBtn" class="btn btn-secondary" title="Sync Data">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="exportBtn" class="btn btn-secondary" title="Export Data">
                        <i class="fas fa-download"></i>
                    </button>
                    <button id="importBtn" class="btn btn-secondary" title="Import Data">
                        <i class="fas fa-upload"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-btn" data-tab="inventory">
                <i class="fas fa-paint-brush"></i>
                <span>Materials</span>
            </button>
            <button class="nav-btn" data-tab="sales">
                <i class="fas fa-shopping-cart"></i>
                <span>Sales</span>
            </button>
            <button class="nav-btn" data-tab="invoices">
                <i class="fas fa-file-invoice"></i>
                <span>Invoices</span>
            </button>
            <button class="nav-btn" data-tab="alerts">
                <i class="fas fa-bell"></i>
                <span>Alerts</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalItems">0</h3>
                            <p>Total Items</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="lowStockItems">0</h3>
                            <p>Low Stock</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalValue">UGX 0</h3>
                            <p>Total Value</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="todaySales">UGX 0</h3>
                            <p>Today's Sales</p>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-sections">
                    <div class="section">
                        <h2>Recent Sales</h2>
                        <div id="recentSales" class="recent-list">
                            <!-- Recent sales will be populated here -->
                        </div>
                    </div>
                    <div class="section">
                        <h2>Low Stock Alerts</h2>
                        <div id="lowStockAlerts" class="alert-list">
                            <!-- Low stock alerts will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory" class="tab-content">
                <div class="tab-header">
                    <h2>Building Materials & Paints</h2>
                    <button id="addItemBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add New Invoice
                    </button>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search items...">
                    <button id="searchBtn" class="btn btn-secondary">
                        <i class="fas fa-search"></i>
                    </button>
                </div>

                <div class="inventory-table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Invoice No</th>
                                <th>Quantity</th>
                                <th>Rate</th>
                                <th>Quality</th>
                                <th>Category</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <!-- Inventory items will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales Tab -->
            <div id="sales" class="tab-content">
                <div class="tab-header">
                    <h2>Sales Management</h2>
                    <button id="newSaleBtn" class="btn btn-primary" onclick="if(window.app){window.app.openSaleModal();} return false;" style="cursor: pointer;">
                        <i class="fas fa-plus"></i> New Sale
                    </button>
                </div>

                <div class="sales-filters">
                    <input type="date" id="dateFrom" class="filter-input">
                    <input type="date" id="dateTo" class="filter-input">
                    <button id="filterSalesBtn" class="btn btn-secondary">Filter</button>
                </div>

                <div class="sales-table-container">
                    <table class="sales-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Items</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <!-- Sales records will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts" class="tab-content">
                <div class="tab-header">
                    <h2>Stock Alerts</h2>
                    <button id="markAllReadBtn" class="btn btn-secondary">
                        <i class="fas fa-check"></i> Mark All Read
                    </button>
                </div>

                <div id="alertsList" class="alerts-container">
                    <!-- Alerts will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="itemModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; padding: 20px; border-radius: 8px 8px 0 0; margin: -20px -20px 20px -20px; position: relative;">
                <h3 id="itemModalTitle" style="margin: 0; text-align: center; font-size: 1.5em; text-transform: uppercase; letter-spacing: 1px;">GOODS REGISTRATION FORM</h3>
                <button class="modal-close" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">&times;</button>
            </div>
            
            <!-- Use System Date Checkbox -->
            <div style="margin-bottom: 20px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="useSystemDate" checked style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                    <span style="font-weight: 500;">Use system date</span>
                </label>
            </div>
            
            <form id="invoiceForm">
                <!-- Form Fields in Two Columns -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Left Column -->
                    <div>
                        <div class="form-group">
                            <label for="invoiceNumber">Invoice No: *</label>
                            <input type="text" id="invoiceNumber" required autocomplete="off" style="border: 2px solid #10b981;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemQuantity">Quantity: *</label>
                            <input type="number" id="itemQuantity" min="1" step="0.1" placeholder="0" required style="border: 2px solid #10b981;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemUnitPrice">Rate: *</label>
                            <input type="number" id="itemUnitPrice" min="0" step="1" placeholder="0" required style="border: 2px solid #10b981;">
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div>
                        <div class="form-group">
                            <label for="vehicleNumber">Vehicle No:</label>
                            <input type="text" id="vehicleNumber" autocomplete="off" style="border: 2px solid #10b981;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemName">Descriptions: *</label>
                            <input type="text" id="itemName" placeholder="Item description" required style="border: 2px solid #10b981;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemTotal">Total Amount:</label>
                            <input type="text" id="itemTotal" readonly placeholder="0" style="background-color: #f3f4f6; cursor: not-allowed; border: 2px solid #10b981;">
                        </div>
                    </div>
                </div>
                
                <!-- Additional Fields: Quality and Category -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="itemQuality">Quality:</label>
                        <select id="itemQuality" style="border: 2px solid #10b981;">
                            <option value="">Select Quality</option>
                            <option value="Premium">Premium</option>
                            <option value="Standard">Standard</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemCategory">Category: *</label>
                        <select id="itemCategory" required style="border: 2px solid #10b981;">
                            <option value="">Select Category</option>
                            <option value="Paint">Paint</option>
                            <option value="Lumber">Lumber</option>
                            <option value="Hardware">Hardware</option>
                            <option value="Tools">Tools</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                
                <!-- Hidden date field (controlled by checkbox) -->
                <input type="date" id="invoiceDate" style="display: none;">

                <!-- Invoice Items List (Hidden initially, shown when items are added) -->
                <div class="invoice-items-section" id="invoiceItemsSection" style="display: none; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0;">Added Items</h4>
                        <span id="invoiceItemCount" class="badge" style="display: none; background-color: #2563eb; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9em;">0 items</span>
                    </div>
                    <div id="invoiceItemsList" class="invoice-items-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; background-color: #f9fafb; margin-bottom: 15px;">
                        <p class="no-items">No items added yet.</p>
                    </div>
                    <div class="invoice-totals" style="background: #f9fafb; padding: 15px; border-radius: 8px;">
                        <div class="total-row" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="total-label"><strong>Subtotal:</strong></span>
                            <span id="invoiceSubtotal" class="total-amount"><strong>UGX 0</strong></span>
                        </div>
                        <div class="total-row" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span class="total-label"><strong>Tax (0%):</strong></span>
                            <span id="invoiceTax" class="total-amount"><strong>UGX 0</strong></span>
                        </div>
                        <div class="total-row grand-total" style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 2px solid #e5e7eb;">
                            <span class="total-label" style="font-size: 1.2em;"><strong>Total:</strong></span>
                            <span id="invoiceGrandTotal" class="total-amount" style="font-size: 1.2em; color: #059669;"><strong>UGX 0</strong></span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions" style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" id="addItemToInvoice" class="btn btn-primary" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer;">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                    <button type="button" class="btn btn-secondary modal-close" style="padding: 12px; border-radius: 6px;">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveInvoiceBtn" disabled style="flex: 1; padding: 12px; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; opacity: 0.5;">
                        <i class="fas fa-check"></i> Confirm Goods
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Item Form Modal (GOODS REGISTRATION FORM) -->
    <div id="itemFormModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; padding: 20px; border-radius: 8px 8px 0 0; margin: -20px -20px 20px -20px; position: relative; display: flex; align-items: center; justify-content: space-between;">
                <h3 id="itemFormModalTitle" style="margin: 0; font-size: 1.5em; text-transform: uppercase; letter-spacing: 1px; flex: 1;">GOODS REGISTRATION FORM</h3>
                
                <!-- Date Selection in Header -->
                <div style="display: flex; align-items: center; gap: 15px; margin-right: 40px;">
                    <label style="display: flex; align-items: center; cursor: pointer; margin: 0;">
                        <input type="checkbox" id="itemFormUseSystemDate" checked style="width: 18px; height: 18px; margin-right: 8px; cursor: pointer;">
                        <span style="font-weight: 500; font-size: 14px;">Use system date</span>
                    </label>
                    <div id="itemFormDateContainer" style="display: none; flex-direction: column; gap: 5px;">
                        <label for="itemFormDate" style="font-weight: 500; font-size: 14px; margin: 0;">Select Date:</label>
                        <input type="date" id="itemFormDate" style="border: 2px solid rgba(255,255,255,0.5); background: rgba(255,255,255,0.15); color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    </div>
                </div>
                
                <button class="modal-close" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">&times;</button>
            </div>
            
            <form id="itemForm">
                <!-- Form Fields in Two Columns -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Left Column -->
                    <div>
                        <div class="form-group">
                            <label for="itemFormInvoiceNo">Invoice No:</label>
                            <input type="text" id="itemFormInvoiceNo" required autocomplete="off" style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemFormQuantity">Quantity:</label>
                            <input type="number" id="itemFormQuantity" min="0" step="0.1" placeholder="0" required style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemFormRate">Rate:</label>
                            <input type="number" id="itemFormRate" min="0" step="1" placeholder="0" required style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemFormQuality">Quality:</label>
                            <input type="text" id="itemFormQuality" list="qualityOptions" autocomplete="off" placeholder="Select or type quality" style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                            <datalist id="qualityOptions">
                                <option value="Premium">Premium</option>
                                <option value="Standard">Standard</option>
                                <option value="Good">Good</option>
                                <option value="Fair">Fair</option>
                                <option value="Excellent">Excellent</option>
                                <option value="Average">Average</option>
                            </datalist>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div>
                        <div class="form-group">
                            <label for="itemFormVehicleNo">Vehicle No:</label>
                            <input type="text" id="itemFormVehicleNo" autocomplete="off" style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemFormDescriptions">Descriptions:</label>
                            <input type="text" id="itemFormDescriptions" placeholder="Item description" required style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemFormTotalAmount">Total Amount:</label>
                            <input type="text" id="itemFormTotalAmount" readonly placeholder="0" style="background-color: #f3f4f6; cursor: not-allowed; border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="itemFormCategory">Category:</label>
                            <input type="text" id="itemFormCategory" list="categoryOptions" autocomplete="off" placeholder="Select or type category" required style="border: 2px solid #10b981; width: 100%; padding: 8px; border-radius: 4px;">
                            <datalist id="categoryOptions">
                                <option value="Paint">Paint</option>
                                <option value="Lumber">Lumber</option>
                                <option value="Hardware">Hardware</option>
                                <option value="Tools">Tools</option>
                                <option value="Electrical">Electrical</option>
                                <option value="Plumbing">Plumbing</option>
                                <option value="Building Materials">Building Materials</option>
                                <option value="Paints & Coatings">Paints & Coatings</option>
                                <option value="Other">Other</option>
                            </datalist>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions" style="display: flex; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb; justify-content: flex-end; align-items: center;">
                    <button type="button" class="btn btn-secondary modal-close" id="cancelGoodsBtn" style="padding: 12px 30px; border-radius: 8px; background-color: #6b7280; color: white; border: none; font-weight: 500; font-size: 15px; cursor: pointer; transition: all 0.3s ease; min-width: 120px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" id="confirmGoodsBtn" style="padding: 12px 30px; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); min-width: 120px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-check" style="font-size: 16px;"></i> 
                        <span>Save Invoice</span>
                    </button>
                </div>
                
                <style>
                    #cancelGoodsBtn:hover {
                        background-color: #4b5563 !important;
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
                        transform: translateY(-1px);
                    }
                    
                    #cancelGoodsBtn:active {
                        transform: translateY(0);
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
                    }
                    
                    #confirmGoodsBtn:hover {
                        background: linear-gradient(135deg, #1d4ed8 0%, #1e3a8a 100%) !important;
                        box-shadow: 0 6px 12px rgba(37, 99, 235, 0.4) !important;
                        transform: translateY(-2px);
                    }
                    
                    #confirmGoodsBtn:active {
                        transform: translateY(0);
                        box-shadow: 0 3px 6px rgba(37, 99, 235, 0.3) !important;
                    }
                    
                    #confirmGoodsBtn:disabled {
                        opacity: 0.5;
                        cursor: not-allowed;
                        transform: none !important;
                    }
                    
                    /* Date input styling in header */
                    #itemFormDate {
                        color-scheme: dark;
                    }
                    
                    #itemFormDate::-webkit-calendar-picker-indicator {
                        filter: invert(1);
                        cursor: pointer;
                    }
                    
                    #itemFormDate::-webkit-datetime-edit-text {
                        color: white;
                    }
                    
                    #itemFormDate::-webkit-datetime-edit-month-field,
                    #itemFormDate::-webkit-datetime-edit-day-field,
                    #itemFormDate::-webkit-datetime-edit-year-field {
                        color: white;
                    }
                </style>
            </form>
        </div>
    </div>

    <div id="saleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>New Sale</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="saleForm">
                <div class="form-group">
                    <label for="saleItem">Select Item *</label>
                    <select id="saleItem" required>
                        <option value="">Choose an item...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="saleQuantity">Quantity *</label>
                    <input type="number" id="saleQuantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="salePrice">Unit Price</label>
                    <input type="number" id="salePrice" min="0" step="1" readonly>
                </div>
                <div class="form-group">
                    <label for="saleTotal">Total</label>
                    <input type="number" id="saleTotal" readonly>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                    <button type="submit" class="btn btn-primary">Complete Sale</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
        <button id="toastClose">&times;</button>
    </div>

    <!-- Scripts -->
    <script src="database-client.js"></script>
    <script src="app.js"></script>
</body>
</html>
